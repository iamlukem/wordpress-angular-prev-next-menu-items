<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<meta name="author" content="Luke Martin" />
	<meta name="description" content="Angular + Wordpress custom menu prev/next links" />

	<title>Angular + Wordpress custom menu prev/next links</title>

</head>
<body>
    <h1>Angular + Wordpress</h1>
    <h2>Displaying custom menu prev/next links</h2>
    <p>
        So the idea of this tutorial is to display 'Previous Page' and 'Next Page' links on your site while adhering to the structure of your custom menu.
    </p>
    <p>
        I am writing this on the the presumtion that:
    </p>
    <ol>
        <li>You already have Angular working and integrated with your Wordpress theme</li>
        <li>You already have a custom menu set up and populated.</li>
        <li>Your custom menu is linked to a menu location (Don't worry if it's not. You will still be able to follow along.)</li>
    </ol>
    <h3>Part1. The Plugins</h3>
    <p>
        First thing you will need (if you don't already) is the almighty <a href="https://wordpress.org/plugins/rest-api/" target="__blank">WordPress REST API (Version 2)</a>.
    </p>
    <p>
        Then you will need the Menu addon <a href="https://wordpress.org/plugins/wp-api-menus/" target="__blank">WP API Menus</a>.
    </p>
    <p>
        Once installed go ahead and test your menu. goto:
    </p>
    <ul>
        <li><code>/wp-json/wp-api-menus/v2/menus/&lt;id&gt;</code> data for a specific menu.</li>
        <li><code>/wp-json/wp-api-menus/v2/menu-locations/&lt;location&gt;</code> data for a menu in a specific menu location.</li>
    </ul>
    <p>
        Here is an example call if your menu location is called 'main_navigation_menu'<br>
        <code>/wp-json/wp-api-menus/v2/menu-locations/main_navigation_menu</code>
    </p>
    <p>
        If it's working you should see something like this.
    </p>
    <code>
        '[{"ID":25,"order":1,"parent":0,"title":"Cool Menu Item","url":"http:\/\/... etc etc'
    </code>

    <h3>Part2. Organising the routes</h3>
    <p>
        Now open you your 'app.js' (or whatever your angular js is called) and make sure you have 'ngRoute'
    </p>
    <p>
        <code>
            angular.module('myapp', ['ngRoute'])
        </code>
    </p>
    <p>
        Now we want to make sure you pass your :slug into your controller through your $routeProvider. It should look something like this:
    </p>
    <code>
        .config(function($routeProvider, $locationProvider) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;$routeProvider<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.when('/:slug', {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateUrl: myLocalized.partials + 'page.php',<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;controller: 'Main'<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>
        &nbsp;&nbsp;&nbsp;&nbsp;$locationProvider.html5Mode(true); //important to remove # from URL<br>
        })
    </code>
    <p>
        so the :slug is essentially a catch all. If you have a specific slug it may look like this.
    </p>
    <code>
        &nbsp;&nbsp;&nbsp;&nbsp;.when('/specific-slug', {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templateUrl: myLocalized.partials + 'page-specific-slug.php',<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;controller: 'SpecificController'<br>
        &nbsp;&nbsp;&nbsp;&nbsp;})<br>
    </code>
    <p>
        Either way, it is important to know the slug for the next part.
    </p>
    <h3>Part3. The controller.</h3>
    <p>
        So here is an example of the controller which is calling the JSON menu. If it sucessfully retrieves the menu we will log it to the console.
    </p>
    <code>
    .controller('Main', function($scope, $rootScope, $http, $routeParams) {<br>
    &nbsp;&nbsp;&nbsp;&nbsp; // Most likely other code here to pass your conetnt to your view.<br>
    &nbsp;&nbsp;&nbsp;&nbsp;<br>
    &nbsp;&nbsp;&nbsp;&nbsp;$http.get('/wp-json/wp-api-menus/v2/menu-locations/main_navigation_menu ').success(function(menu){<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('Menu Success'); //quick log to check its working<br>
    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
    })
    </code>
    <h4>Filtering through the menu.</h4>
    <p>Once we have the JSON call working sweet. we have to:</p>
    <ol>
        <li>Find the current menu item by matching the slug</li>
        <li>Find what item is after it</li>
        <li>Find what item is before it</li>
        <li>Add some extra functionality if the item is at the start or end</li>
        <li>Pass the items to the view</li>
    </ol>
    <code>
        .controller('Main', function($scope, $rootScope, $http, $routeParams) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;$http.get('/wp-json/wp-api-menus/v2/menu-locations/main_navigation_menu ').success(function(menu){<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var location = 0;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var menuLength = menu.length-1; // cause arrays start at 0 not 1<br>
        &nbsp;&nbsp;&nbsp;&nbsp;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angular.forEach(menu, function(value, key) { // standard forEach loop<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var url = value.url; // store the current items url<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(url.indexOf($routeParams.slug) > -1) {// check to see if it contains the slug passed to the controller<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location = key; // store the position for later use<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
        &nbsp;&nbsp;&nbsp;&nbsp;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(location == 0) { // if the location of the current page is at the start of the menu<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.menunext = menu[location+1]; // set the next link to be the next menu item<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.menuprev = menu[menuLength]; // set the prev link to be the last item in the menu<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else if(location == menuLength) { // if the location of the current page is at the end of the menu<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.menunext = menu[0]; // set the next link to be the first menu item<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.menuprev = menu[location-1]; // set the prev link to be the prevoius menu item<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.menunext = menu[location+1]; // set the next link to be the next menu item<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$scope.menuprev = menu[location-1]; // set the prev link to be the prevoius menu item<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;});<br>
        })
    </code>

    <h3>Part4. The View.</h3>
    <p>
        So with our items passed though the scope all we have to do is display the menu data.
    </p>
    <code>
        &lt;a href="{{menuprev.url}}"&gt;PREV: {{menuprev.title}}&lt;/a&gt;<br>
        &lt;a href="{{menunext.url}}"&gt;NEXT: {{menunext.title}}&lt;/a&gt;
    </code>
    <p>
        I plan to style this page and make the tutorial better, however, if you can't wait you can follow me here <a href="https://twitter.com/iamlukem">@iamlukem</a> and ask any qiestions.
    </p>

</body>
</html>
